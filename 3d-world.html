<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VR City Walk</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>

  <style>
    /* Стили для текста с авторскими правами */
    #attribution {
      position: absolute;
      bottom: 10px;
      left: 10px;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.6);
      color: rgba(255, 255, 255, 0.8);
      padding: 10px;
      font-family: sans-serif;
      font-size: 10px;
      border-radius: 5px;
      pointer-events: none; /* Чтобы не мешало кликам */
    }
    
    /* Экран паузы */
    #pause-screen {
      display: none;
      position: absolute;
      top: 0; left: 0; width: 100vw; height: 100vh;
      background: black;
      color: white;
      z-index: 2000;
      text-align: center;
      font-family: sans-serif;
      padding-top: 40vh;
    }
  </style>

  <script>
    // Компонент для открытия дверей
    AFRAME.registerComponent('door-interact', {
      init: function () {
        let isOpen = false;
        this.el.addEventListener('click', () => {
          // Анимация вращения двери на 90 градусов
          let targetRotation = isOpen ? '0 0 0' : '0 90 0';
          this.el.setAttribute('animation', `property: rotation; to: ${targetRotation}; dur: 800; easing: easeInOutQuad`);
          isOpen = !isOpen;
        });
      }
    });

    // Компонент для управления тапами (Тройной тап для паузы)
    AFRAME.registerComponent('tap-manager', {
      init: function () {
        this.tapCount = 0;
        this.tapTimer = null;
        this.isPaused = false;
        this.bgm = document.querySelector('#bgm');
        this.pauseScreen = document.getElementById('pause-screen');
        this.cameraRig = document.querySelector('#camera-rig');

        window.addEventListener('touchstart', (e) => {
          this.tapCount++;
          
          if (this.tapCount === 1) {
            this.tapTimer = setTimeout(() => {
              // --- ОДИНАРНЫЙ ТАП ---
              if (this.tapCount === 1) {
                // Включаем музыку при первом тапе (если она не играет)
                if (this.bgm.paused) this.bgm.play();
                
                // Если мы были на паузе — снимаем её
                if (this.isPaused) {
                  this.isPaused = false;
                  this.pauseScreen.style.display = 'none';
                  // В идеале здесь нужен сложный математический расчет смещения (Rig Offset), 
                  // но для браузера достаточно просто скрыть черный экран.
                }
              } 
              // --- ТРОЙНОЙ ТАП ---
              else if (this.tapCount === 3) {
                this.isPaused = true;
                this.pauseScreen.style.display = 'block';
              }
              
              this.tapCount = 0; // Сбрасываем счетчик
            }, 400); // Окно времени для тапов (400 мс)
          }
        });
      }
    });
  </script>
</head>
<body>

  <div id="attribution">
    Run Amok by Kevin MacLeod | https://incompetech.com/<br>
    Music promoted by https://www.chosic.com/free-music/all/<br>
    Creative Commons CC BY 3.0<br>
    https://creativecommons.org/licenses/by/3.0/
  </div>

  <div id="pause-screen">
    <h2>Передвижение на паузе</h2>
    <p>Отойдите в центр вашей реальной комнаты.<br>Нажмите на экран 1 раз, чтобы продолжить.</p>
  </div>

  <a-scene tap-manager>
    <a-assets>
      <audio id="bgm" src="https://www.chosic.com/wp-content/uploads/2022/06/Run-Amok(chosic.com).mp3" preload="auto" loop></audio>
    </a-assets>

    <a-entity id="camera-rig" position="0 0 0">
      <a-camera position="0 1.6 0">
        <a-entity cursor="fuse: false; rayOrigin: entity;"
                  position="0 0 -1"
                  geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                  material="color: white; shader: flat"
                  animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 1 1 1">
        </a-entity>
      </a-camera>
    </a-entity>

    <a-sky color="#87CEEB"></a-sky>
    <a-plane position="0 0 0" rotation="-90 0 0" width="50" height="50" color="#7BC8A4"></a-plane>

    <a-entity position="-3 0 -5">
      <a-box position="0 1.5 0" width="3" height="3" depth="3" color="#D2B48C"></a-box>
      <a-cone position="0 3.5 0" radius-bottom="2.5" height="1.5" color="#8B0000"></a-cone>
      
      <a-entity position="0.5 0 1.5">
        <a-box position="-0.4 1 0" width="0.8" height="2" depth="0.1" color="#654321" door-interact class="clickable"></a-box>
      </a-entity>
    </a-entity>

    <a-entity position="4 0 -4" rotation="0 -30 0">
      <a-box position="0 2 0" width="4" height="4" depth="2" color="#A9A9A9"></a-box>
      <a-entity position="-1 0 1">
        <a-box position="-0.4 1 0" width="0.8" height="2" depth="0.1" color="#3e2723" door-interact class="clickable"></a-box>
      </a-entity>
    </a-entity>

    <a-entity position="-2 0 -2">
      <a-cylinder position="0 1.5 0" radius="0.05" height="3" color="#2F4F4F"></a-cylinder>
      <a-sphere position="0 3 0" radius="0.3" color="#FFFFE0"></a-sphere>
      <a-light type="point" color="#FFF" intensity="0.5" position="0 3 0"></a-light>
    </a-entity>

    <a-entity position="2 0.3 -2">
      <a-box position="0 0 0" width="1.5" height="0.1" depth="0.5" color="#8B4513"></a-box>
      <a-box position="0 0.4 -0.2" width="1.5" height="0.6" depth="0.1" color="#8B4513"></a-box>
      <a-box position="-0.6 -0.15 0" width="0.1" height="0.3" depth="0.4" color="#2F4F4F"></a-box>
      <a-box position="0.6 -0.15 0" width="0.1" height="0.3" depth="0.4" color="#2F4F4F"></a-box>
    </a-entity>

    <a-entity position="0 0 -8">
      <a-cylinder position="0 0.5 0" radius="0.3" height="1" color="#1E90FF"></a-cylinder>
      <a-sphere position="0 1.3 0" radius="0.25" color="#FFD700"></a-sphere>
      <a-text value="Hello! I'm NPC." position="0 1.8 0" align="center" color="#000" scale="0.5 0.5 0.5"></a-text>
    </a-entity>

    <a-light type="ambient" color="#BBB"></a-light>
    <a-light type="directional" color="#FFF" intensity="0.6" position="-0.5 1 1"></a-light>
  </a-scene>

</body>
</html>