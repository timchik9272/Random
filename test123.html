<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resmush.it Demo ‚Äî –î–æ / –ü–æ—Å–ª–µ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
        .drop-zone { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .drop-zone.dragover { background-color: #f0f9ff; border-color: #3b82f6; transform: scale(1.02); }
        .comparison-container { position: relative; overflow: hidden; border-radius: 16px; box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1); }
        .slider { position: absolute; top: 0; bottom: 0; left: 50%; width: 6px; background: white; box-shadow: 0 0 15px rgba(0,0,0,0.4); cursor: ew-resize; z-index: 30; }
        .slider::after { content: '‚áÜ'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 44px; height: 44px; background: #3b82f6; color: white; border-radius: 9999px; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.3); }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen py-12">
    <div class="max-w-6xl mx-auto px-6">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="text-center mb-10">
            <h1 class="text-5xl font-bold text-slate-900 flex items-center justify-center gap-4">
                <i class="fa-solid fa-compress text-blue-600"></i> Resmush.it Demo
            </h1>
            <p class="text-xl text-slate-600 mt-3">–î–æ / –ü–æ—Å–ª–µ + —Ç–æ—á–Ω—ã–π –≤–µ—Å + —Å–ª–∞–π–¥–µ—Ä –∫–∞—á–µ—Å—Ç–≤–∞</p>
        </div>

        <!-- –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï (–≥–ª–∞–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ—à–ª—ã—Ö –æ—à–∏–±–æ–∫) -->
        <div class="mb-10 bg-amber-50 border-2 border-amber-400 text-amber-900 p-6 rounded-3xl text-center text-lg">
            <strong>‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:</strong> –û—Ç–∫—Ä—ã–≤–∞–π —Ñ–∞–π–ª –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä!<br>
            <code class="bg-white px-4 py-2 rounded-2xl font-mono text-base mt-2 inline-block">python3 -m http.server 8000</code><br>
            <span class="text-sm text-amber-700">–ó–∞—Ç–µ–º –ø–µ—Ä–µ–π–¥–∏ –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:8000/resmush-demo.html</span>
        </div>

        <!-- –ó–æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="uploadArea" 
             class="drop-zone border-4 border-dashed border-slate-300 bg-white rounded-3xl p-20 text-center cursor-pointer hover:border-blue-500">
            <input type="file" id="fileInput" accept="image/jpeg,image/png,image/gif,image/webp" class="hidden">
            <i class="fa-solid fa-cloud-arrow-up text-8xl text-slate-300 mb-8"></i>
            <p class="text-3xl font-semibold text-slate-700">–ü–µ—Ä–µ—Ç–∞—â–∏ —Ñ–æ—Ç–æ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏</p>
            <p class="text-slate-500 mt-3">JPG, PNG, GIF, WebP ‚Ä¢ –¥–æ 5 –ú–ë</p>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div id="controls" class="hidden mt-10 bg-white rounded-3xl shadow-xl p-10">
            <div class="flex flex-col md:flex-row gap-8 items-end">
                <div class="flex-1">
                    <label class="block text-sm font-medium text-slate-600 mb-2">–ö–∞—á–µ—Å—Ç–≤–æ —Å–∂–∞—Ç–∏—è (qlty)</label>
                    <select id="quality" class="w-full bg-slate-100 border border-slate-300 rounded-3xl px-8 py-5 text-xl focus:outline-none focus:ring-4 focus:ring-blue-200">
                        <option value="92" selected>92 ‚Äî –ª—É—á—à–∏–π –±–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞</option>
                        <option value="95">95 ‚Äî –ø–æ—á—Ç–∏ –±–µ–∑ –ø–æ—Ç–µ—Ä—å –∫–∞—á–µ—Å—Ç–≤–∞</option>
                        <option value="90">90 ‚Äî —Ö–æ—Ä–æ—à–µ–µ —Å–∂–∞—Ç–∏–µ</option>
                        <option value="85">85 ‚Äî —Å–∏–ª—å–Ω–æ–µ —Å–∂–∞—Ç–∏–µ</option>
                    </select>
                </div>
                <button onclick="startOptimization()" id="optimizeBtn"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-16 py-5 rounded-3xl font-semibold text-xl flex items-center gap-4 transition-all active:scale-95">
                    <i class="fa-solid fa-wand-magic-sparkles"></i>
                    –°–∂–∞—Ç—å —á–µ—Ä–µ–∑ Resmush.it
                </button>
            </div>
        </div>

        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
        <div id="loading" class="hidden text-center py-32">
            <div class="mx-auto w-20 h-20 border-8 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
            <p class="mt-10 text-2xl text-slate-600">–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ –≤ –æ–±–ª–∞–∫–æ Resmush.it...</p>
            <p class="text-slate-400 mt-2">2‚Äì5 —Å–µ–∫—É–Ω–¥</p>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (—Ç–µ–ø–µ—Ä—å –í–°–ï —ç–ª–µ–º–µ–Ω—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞) -->
        <div id="results" class="hidden mt-12">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                <!-- –î–û -->
                <div class="bg-white rounded-3xl shadow-xl overflow-hidden">
                    <div class="bg-red-50 px-8 py-5 flex items-center gap-4">
                        <i class="fa-solid fa-image text-3xl text-red-600"></i>
                        <div>
                            <div class="font-bold text-red-700 text-xl">–î–û –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</div>
                            <div id="originalName" class="text-red-500 text-sm"></div>
                        </div>
                    </div>
                    <div class="p-8">
                        <img id="originalImg" class="w-full rounded-2xl shadow-md" style="max-height: 460px; object-fit: contain;">
                        <div class="mt-8 grid grid-cols-2 gap-6">
                            <div>
                                <div class="text-xs uppercase tracking-widest text-slate-500">–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞</div>
                                <div id="originalSize" class="text-6xl font-bold text-slate-900">‚Äî</div>
                                <div class="text-sm text-slate-500">–ö–ë</div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs uppercase tracking-widest text-slate-500">–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ</div>
                                <div id="originalDimensions" class="font-mono text-3xl font-semibold text-slate-900">‚Äî</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ü–û–°–õ–ï -->
                <div class="bg-white rounded-3xl shadow-xl overflow-hidden">
                    <div class="bg-emerald-50 px-8 py-5 flex items-center gap-4">
                        <i class="fa-solid fa-compress text-3xl text-emerald-600"></i>
                        <div>
                            <div class="font-bold text-emerald-700 text-xl">–ü–û–°–õ–ï –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</div>
                            <div id="savingsPercent" class="text-emerald-600 text-4xl font-bold">‚Äî%</div>
                        </div>
                    </div>
                    <div class="p-8">
                        <img id="optimizedImg" class="w-full rounded-2xl shadow-md" style="max-height: 460px; object-fit: contain;">
                        <div class="mt-8 grid grid-cols-2 gap-6">
                            <div>
                                <div class="text-xs uppercase tracking-widest text-slate-500">–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞</div>
                                <div id="optimizedSize" class="text-6xl font-bold text-emerald-600">‚Äî</div>
                                <div class="text-sm text-slate-500">–ö–ë</div>
                            </div>
                            <div class="text-right">
                                <a id="downloadBtn" href="#" 
                                   class="inline-flex items-center gap-3 bg-emerald-600 hover:bg-emerald-700 text-white px-10 py-4 rounded-3xl text-lg font-medium">
                                    <i class="fa-solid fa-download"></i> –°–∫–∞—á–∞—Ç—å
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°–ª–∞–π–¥–µ—Ä —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ -->
            <div class="mt-16">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-3xl font-semibold">–í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞</h3>
                    <div class="flex gap-4 text-sm">
                        <span class="bg-red-100 text-red-700 px-5 py-2 rounded-3xl">‚Üê –û—Ä–∏–≥–∏–Ω–∞–ª</span>
                        <span class="bg-emerald-100 text-emerald-700 px-5 py-2 rounded-3xl">–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ‚Üí</span>
                    </div>
                </div>
                <div id="comparisonWrapper" class="comparison-container mx-auto" style="max-width: 900px; height: 520px;">
                    <img id="compOriginal" class="absolute inset-0 w-full h-full object-contain" style="clip-path: polygon(0 0, 50% 0, 50% 100%, 0 100%);">
                    <img id="compOptimized" class="absolute inset-0 w-full h-full object-contain">
                    <div id="slider" class="slider"></div>
                </div>
            </div>

            <!-- –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="mt-12 bg-white rounded-3xl p-10 flex justify-center gap-16 text-center">
                <div>
                    <div id="percentBig" class="text-7xl font-black text-emerald-600">‚Äî%</div>
                    <div class="text-slate-500">–≠–ö–û–ù–û–ú–ò–Ø</div>
                </div>
                <div>
                    <div id="originalBig" class="text-7xl font-black text-slate-900">‚Äî –ö–ë</div>
                    <div class="text-slate-500">–ë–´–õ–û</div>
                </div>
                <div>
                    <div id="optimizedBig" class="text-7xl font-black text-emerald-600">‚Äî –ö–ë</div>
                    <div class="text-slate-500">–°–¢–ê–õ–û</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let originalFile = null;
        let originalUrl = null;
        let optimizedUrl = null;

        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const controls = document.getElementById('controls');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');

        // Drag & Drop + –∫–ª–∏–∫
        uploadArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', e => e.target.files[0] && handleFile(e.target.files[0]));
        uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
        uploadArea.addEventListener('drop', e => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);
        });

        function handleFile(file) {
            if (!file.type.startsWith('image/')) return alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
            if (file.size > 5 * 1024 * 1024) return alert('–§–∞–π–ª –±–æ–ª—å—à–µ 5 –ú–ë');

            originalFile = file;
            originalUrl = URL.createObjectURL(file);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é –∏ —Ä–∞–∑–º–µ—Ä—ã –î–û (—ç–ª–µ–º–µ–Ω—Ç—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç!)
            document.getElementById('originalImg').src = originalUrl;
            document.getElementById('originalName').textContent = file.name;

            const sizeKB = (file.size / 1024).toFixed(1);
            document.getElementById('originalSize').textContent = sizeKB;
            document.getElementById('originalBig').textContent = sizeKB + ' –ö–ë';

            // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
            const tempImg = new Image();
            tempImg.onload = () => {
                document.getElementById('originalDimensions').textContent = `${tempImg.width}√ó${tempImg.height}`;
            };
            tempImg.src = originalUrl;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å
            controls.classList.remove('hidden');
            uploadArea.classList.add('hidden');
        }

        async function startOptimization() {
            if (!originalFile) return;

            loading.classList.remove('hidden');
            results.classList.add('hidden');
            document.getElementById('optimizeBtn').disabled = true;

            const qlty = document.getElementById('quality').value;

            const formData = new FormData();
            formData.append('files', originalFile);

            try {
                const response = await fetch(`https://api.resmush.it/?qlty=${qlty}`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error(`HTTP –æ—à–∏–±–∫–∞ ${response.status}`);

                const data = await response.json();

                if (data.error) throw new Error(data.error_log || data.error);

                optimizedUrl = data.dest;

                // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                const origKB = (data.src_size / 1024).toFixed(1);
                const optKB = (data.dest_size / 1024).toFixed(1);
                const percent = data.percent.toFixed(1);

                document.getElementById('originalSize').textContent = origKB;
                document.getElementById('optimizedSize').textContent = optKB;
                document.getElementById('savingsPercent').innerHTML = `‚àí${percent}% <span class="text-2xl">üí∞</span>`;
                document.getElementById('percentBig').textContent = `‚àí${percent}%`;
                document.getElementById('originalBig').textContent = `${origKB} –ö–ë`;
                document.getElementById('optimizedBig').textContent = `${optKB} –ö–ë`;

                // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                document.getElementById('optimizedImg').src = optimizedUrl;
                document.getElementById('compOriginal').src = originalUrl;
                document.getElementById('compOptimized').src = optimizedUrl;

                // –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                const downloadBtn = document.getElementById('downloadBtn');
                downloadBtn.href = optimizedUrl;
                downloadBtn.download = 'optimized_' + originalFile.name;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                loading.classList.add('hidden');
                results.classList.remove('hidden');

                // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–ª–∞–π–¥–µ—Ä
                initSlider();

            } catch (err) {
                loading.classList.add('hidden');
                alert('‚ùå –û—à–∏–±–∫–∞:\n' + err.message + '\n\n–ï—Å–ª–∏ –≤–∏–¥–∏—à—å CORS –∏–ª–∏ "Failed to fetch" ‚Äî –∑–∞–ø—É—Å—Ç–∏ —á–µ—Ä–µ–∑ python -m http.server!');
                document.getElementById('optimizeBtn').disabled = false;
            }
        }

        function initSlider() {
            const wrapper = document.getElementById('comparisonWrapper');
            const slider = document.getElementById('slider');
            let dragging = false;

            function move(e) {
                if (!dragging) return;
                const rect = wrapper.getBoundingClientRect();
                let percent = ((e.clientX || e.touches[0].clientX) - rect.left) / rect.width * 100;
                percent = Math.max(5, Math.min(95, percent));
                slider.style.left = percent + '%';
                document.getElementById('compOriginal').style.clipPath = `polygon(0 0, ${percent}% 0, ${percent}% 100%, 0 100%)`;
            }

            slider.addEventListener('mousedown', () => dragging = true);
            document.addEventListener('mousemove', move);
            document.addEventListener('mouseup', () => dragging = false);

            // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∞—á—Å–∫—Ä–∏–Ω–∞
            slider.addEventListener('touchstart', () => dragging = true);
            document.addEventListener('touchmove', move);
            document.addEventListener('touchend', () => dragging = false);

            // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
            setTimeout(() => {
                slider.style.left = '50%';
                document.getElementById('compOriginal').style.clipPath = 'polygon(0 0, 50% 0, 50% 100%, 0 100%)';
            }, 100);
        }
    </script>
</body>
</html>