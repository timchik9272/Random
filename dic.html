<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∏–ª—å–Ω—ã–π –î–∏–∫—Ç–æ—Ñ–æ–Ω</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .recorder-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-weight: 700;
        }
        .subtitle {
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        #visualizer {
            height: 120px;
            width: 100%;
            background: #f1f3f9;
            border-radius: 16px;
            margin-bottom: 30px;
            overflow: hidden;
            position: relative;
            border: 2px solid #e0e6ff;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        .btn {
            border: none;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            color: white;
        }
        .btn:active {
            transform: scale(0.95);
        }
        #recordBtn {
            background: linear-gradient(to right, #ff416c, #ff4b2b);
        }
        #recordBtn:hover {
            background: linear-gradient(to right, #e03a61, #e04427);
            box-shadow: 0 10px 25px rgba(255, 65, 108, 0.4);
        }
        #pauseBtn {
            background: linear-gradient(to right, #11998e, #38ef7d);
        }
        #pauseBtn:hover {
            background: linear-gradient(to right, #0f8a7f, #32d670);
            box-shadow: 0 10px 25px rgba(17, 153, 142, 0.4);
        }
        #saveBtn {
            background: linear-gradient(to right, #36d1dc, #5b86e5);
        }
        #saveBtn:hover {
            background: linear-gradient(to right, #30bcc7, #5178ce);
            box-shadow: 0 10px 25px rgba(91, 134, 229, 0.4);
        }
        .btn:disabled {
            background: #cccccc !important;
            cursor: not-allowed;
            transform: scale(1);
            box-shadow: none;
        }
        .status {
            font-size: 1.2em;
            margin: 25px 0;
            padding: 15px;
            border-radius: 12px;
            font-weight: 600;
            min-height: 58px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #recordingsList {
            text-align: left;
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 25px;
        }
        #recordingsList h3 {
            color: #444;
            margin-bottom: 15px;
        }
        .recording-item {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        audio {
            width: 70%;
            height: 40px;
            outline: none;
        }
        audio::-webkit-media-controls-panel {
            background-color: #eef2ff;
            border-radius: 20px;
        }
        @media (max-width: 600px) {
            .recorder-container {
                padding: 30px 25px;
            }
            .btn {
                width: 65px;
                height: 65px;
            }
            .controls {
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="recorder-container">
        <h1>üéôÔ∏è –°—Ç–∏–ª—å–Ω—ã–π –î–∏–∫—Ç–æ—Ñ–æ–Ω</h1>
        <p class="subtitle">–ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ, —Å—Ç–∞–≤—å—Ç–µ –Ω–∞ –ø–∞—É–∑—É –∏ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∞—É–¥–∏–æ –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>

        <!-- –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä (–∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø–∏—Å–∏) -->
        <div id="visualizer"></div>

        <!-- –°—Ç–∞—Ç—É—Å –∑–∞–ø–∏—Å–∏ -->
        <div class="status" id="status">–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø–∏—Å–∏. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∑–∞–ø–∏—Å–∏ (üî¥).</div>

        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="controls">
            <button class="btn" id="recordBtn" title="–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å">üî¥</button>
            <button class="btn" id="pauseBtn" title="–ü–∞—É–∑–∞ / –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" disabled>‚è∏Ô∏è</button>
            <button class="btn" id="saveBtn" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å" disabled>üíæ</button>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π -->
        <div id="recordingsList">
            <h3>üìÅ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏:</h3>
            <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–∞–ø–∏—Å–∏ -->
        </div>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        const recordBtn = document.getElementById('recordBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const saveBtn = document.getElementById('saveBtn');
        const statusEl = document.getElementById('status');
        const visualizer = document.getElementById('visualizer');
        const recordingsList = document.getElementById('recordingsList');

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–ø–∏—Å—å—é
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        let isPaused = false;
        let stream;
        let audioContext;
        let analyser;
        let animationId;

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∏ —Å—Ç–∏–ª–µ–π
        function updateUI() {
            recordBtn.style.background = isRecording
                ? 'linear-gradient(to right, #5a5a5a, #333)'
                : 'linear-gradient(to right, #ff416c, #ff4b2b)';
            recordBtn.innerHTML = isRecording ? '‚èπÔ∏è' : 'üî¥';
            recordBtn.title = isRecording ? '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å' : '–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å';

            pauseBtn.disabled = !isRecording;
            pauseBtn.innerHTML = isPaused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
            pauseBtn.title = isPaused ? '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∑–∞–ø–∏—Å—å' : '–ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ø–∞—É–∑—É';

            saveBtn.disabled = audioChunks.length === 0;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∞—Ç—É—Å–∞
            if (!isRecording && audioChunks.length === 0) {
                statusEl.textContent = '–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø–∏—Å–∏. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∑–∞–ø–∏—Å–∏ (üî¥).';
                statusEl.style.background = '#e8f5e9';
                statusEl.style.color = '#2e7d32';
            } else if (isRecording && !isPaused) {
                statusEl.textContent = '–ò–¥–µ—Ç –∑–∞–ø–∏—Å—å...';
                statusEl.style.background = '#ffebee';
                statusEl.style.color = '#c62828';
            } else if (isRecording && isPaused) {
                statusEl.textContent = '–ó–∞–ø–∏—Å—å –Ω–∞ –ø–∞—É–∑–µ';
                statusEl.style.background = '#fff3e0';
                statusEl.style.color = '#ef6c00';
            } else if (!isRecording && audioChunks.length > 0) {
                statusEl.textContent = '–ó–∞–ø–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å (üíæ).';
                statusEl.style.background = '#e3f2fd';
                statusEl.style.color = '#1565c0';
            }
        }

        // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ (–∞–Ω–∏–º–∞—Ü–∏—è –≤–æ–ª–Ω—ã)
        function drawVisualizer() {
            if (!analyser || !isRecording || isPaused) {
                visualizer.innerHTML = '';
                return;
            }

            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);

            // –û—á–∏—â–∞–µ–º –∏ —Ä–∏—Å—É–µ–º –Ω–æ–≤—É—é –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
            visualizer.innerHTML = '';
            const barCount = 50;
            const barWidth = visualizer.clientWidth / barCount;

            for (let i = 0; i < barCount; i++) {
                const bar = document.createElement('div');
                const value = dataArray[Math.floor(i * bufferLength / barCount)];
                const height = Math.max(2, (value / 255) * 100);
                bar.style.cssText = `
                    position: absolute;
                    bottom: 0;
                    left: ${i * barWidth}px;
                    width: ${barWidth - 2}px;
                    height: ${height}%;
                    background: linear-gradient(to top, #667eea, #764ba2);
                    border-radius: 2px 2px 0 0;
                `;
                visualizer.appendChild(bar);
            }

            animationId = requestAnimationFrame(drawVisualizer);
        }

        // –ù–∞—á–∞–ª–æ –∑–∞–ø–∏—Å–∏
        async function startRecording() {
            try {
                // –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
                stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);

                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É–¥–∏–æ–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                const source = audioContext.createMediaStreamSource(stream);
                source.connect(analyser);
                analyser.fftSize = 256;

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π MediaRecorder
                mediaRecorder.ondataavailable = event => {
                    if (event.data.size > 0) audioChunks.push(event.data);
                };

                mediaRecorder.onstop = () => {
                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
                    cancelAnimationFrame(animationId);
                    visualizer.innerHTML = '';
                    if (audioContext) audioContext.close();
                    if (stream) stream.getTracks().forEach(track => track.stop());
                    updateUI();
                };

                // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–∏—Å—å
                mediaRecorder.start(100); // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 100 –º—Å
                isRecording = true;
                updateUI();
                drawVisualizer(); // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é

            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É:', err);
                statusEl.textContent = '–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É.';
                statusEl.style.background = '#ffebee';
                statusEl.style.color = '#c62828';
            }
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                isPaused = false;
                updateUI();
            }
        }

        // –ü–∞—É–∑–∞ / –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
        function togglePause() {
            if (!mediaRecorder || !isRecording) return;

            if (isPaused) {
                mediaRecorder.resume();
                isPaused = false;
                drawVisualizer(); // –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            } else {
                mediaRecorder.pause();
                isPaused = true;
                cancelAnimationFrame(animationId); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
                visualizer.innerHTML = '';
            }
            updateUI();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
        function saveRecording() {
            if (audioChunks.length === 0) return;

            // –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –∏–∑ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            const audioUrl = URL.createObjectURL(audioBlob);
            const timestamp = new Date().toLocaleString('ru-RU');
            const filename = `–∑–∞–ø–∏—Å—å_${Date.now()}.wav`;

            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ —Å–ø–∏—Å–æ–∫
            const recordingItem = document.createElement('div');
            recordingItem.className = 'recording-item';
            recordingItem.innerHTML = `
                <div>
                    <strong>${timestamp}</strong><br>
                    <small>${(audioBlob.size / 1024 / 1024).toFixed(2)} –ú–ë</small>
                </div>
                <audio controls src="${audioUrl}"></audio>
                <a href="${audioUrl}" download="${filename}" class="btn" style="
                    background: #4CAF50; 
                    width: auto; 
                    border-radius: 20px; 
                    padding: 10px 15px; 
                    font-size: 14px;
                    text-decoration: none;">
                    ‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å
                </a>
            `;

            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞
            recordingsList.appendChild(recordingItem);

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –∑–∞–ø–∏—Å—å
            audioChunks = [];
            updateUI();

            // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            statusEl.textContent = `–ó–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∫–∞–∫ "${filename}"`;
            statusEl.style.background = '#e8f5e9';
            statusEl.style.color = '#2e7d32';
            setTimeout(updateUI, 3000);
        }

        // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        recordBtn.addEventListener('click', () => {
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        });

        pauseBtn.addEventListener('click', togglePause);
        saveBtn.addEventListener('click', saveRecording);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        updateUI();
    </script>
</body>
</html>
