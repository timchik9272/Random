<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>WebRTC P2P звонок</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    textarea { width: 90%; height: 100px; margin: 5px; }
    video { width: 45%; margin: 5px; border-radius: 10px; }
    #videos { display: flex; justify-content: center; }
  </style>
</head>
<body>
  <h2>WebRTC звонок (без сервера)</h2>

  <div id="videos">
    <video id="localVideo" autoplay playsinline muted></video>
    <video id="remoteVideo" autoplay playsinline></video>
  </div>

  <button id="createOffer">Создать оффер</button>
  <button id="createAnswer">Создать ансуер</button>
  <br>
  <textarea id="localData" placeholder="Здесь появятся данные"></textarea>
  <textarea id="remoteData" placeholder="Вставь сюда данные от собеседника"></textarea>
  <button id="applyRemote">Применить удалённые данные</button>

  <script>
    const pc = new RTCPeerConnection({
      iceServers: [{ urls: "stun:stun.l.google.com:19302" }]
    });

    const localVideo = document.getElementById("localVideo");
    const remoteVideo = document.getElementById("remoteVideo");
    const localData = document.getElementById("localData");
    const remoteData = document.getElementById("remoteData");

    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
      .then(stream => {
        localVideo.srcObject = stream;
        stream.getTracks().forEach(track => pc.addTrack(track, stream));
      });

    pc.ontrack = event => {
      remoteVideo.srcObject = event.streams[0];
    };

    // ICE-кандидаты автоматически добавляем в локальные данные
    pc.onicecandidate = () => {
      localData.value = JSON.stringify(pc.localDescription);
    };

    document.getElementById("createOffer").onclick = async () => {
      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      localData.value = JSON.stringify(offer);
    };

    document.getElementById("createAnswer").onclick = async () => {
      const offer = JSON.parse(remoteData.value);
      await pc.setRemoteDescription(new RTCSessionDescription(offer));
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
      localData.value = JSON.stringify(answer);
    };

    document.getElementById("applyRemote").onclick = async () => {
      const answer = JSON.parse(remoteData.value);
      await pc.setRemoteDescription(new RTCSessionDescription(answer));
    };
  </script>
</body>
</html>
