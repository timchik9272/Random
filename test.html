<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>MiniMessenger</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --bg: #0e0e0e;
      --bg-light: #1e1e1e;
      --accent: #0088cc;
      --text: #fff;
      --gray: #888;
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    body {
      margin:0; font-family: system-ui, sans-serif;
      background: var(--bg); color: var(--text);
    }
    .screen { display:none; flex-direction:column; height:100vh; padding:16px; }
    .active { display:flex; }
    h2 { margin:0 0 16px; }
    input, button, textarea {
      border-radius: var(--radius); border:none; font-size:16px;
    }
    input, textarea { background: var(--bg-light); color: var(--text); }
    textarea { resize:none; padding:10px; line-height:1.4; width:100%; }
    button { background: var(--accent); color:white; font-weight:bold; cursor:pointer; }
    button:active { opacity:0.7; }
    .chat-list, .messages { flex:1; overflow-y:auto; }
    .chat-item {
      padding:14px; border-bottom:1px solid #222;
      display:flex; align-items:center; cursor:pointer;
    }
    .chat-item span { font-weight:bold; }
    .msg {
      margin:6px 0; padding:10px 14px;
      border-radius: var(--radius);
      max-width:75%; word-wrap: break-word;
    }
    .msg.me { background: var(--accent); margin-left:auto; }
    .msg.other { background: var(--bg-light); }
    .msg.deleted { font-style:italic; color:var(--gray); background:none; }
    nav { display:flex; justify-content:space-between; align-items:center; padding:10px 0; }
    nav button { width:auto; padding:10px 16px; font-size:14px; }

    /* –ù–æ–≤–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –≤–≤–æ–¥–∞ */
    .input-box {
      display:flex; align-items:flex-end; gap:8px; padding:8px 0;
    }
    .input-box textarea {
      flex:1;
      min-height:42px;
      max-height:120px;
      overflow-y:auto;
    }
    .send-btn {
      background: var(--accent);
      border:none;
      width:42px;
      height:42px;
      border-radius:50%;
      display:flex;
      justify-content:center;
      align-items:center;
      font-size:18px;
      cursor:pointer;
    }
    .send-btn i { margin:0; }
  </style>
</head>
<body>
  <!-- CHAT -->
  <div id="chat-screen" class="screen">
    <nav>
      <button onclick="backToMain()"><i class="fa fa-arrow-left"></i></button>
      <h2 id="chat-username">–ß–∞—Ç</h2>
    </nav>
    <div class="messages" id="messages"></div>
    <div class="input-box">
      <textarea id="msg-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
      <button class="send-btn" onclick="sendMessage()"><i class="fa fa-paper-plane"></i></button>
    </div>
  </div>

<script>
  // üéØ –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ Enter, –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ Shift+Enter
  document.addEventListener("keydown", function(e){
    if(e.target.id==="msg-input"){
      if(e.key==="Enter" && !e.shiftKey){
        e.preventDefault();
        sendMessage();
      }
    }
  });

  async function sendMessage(){
    const input=document.getElementById('msg-input');
    const text=input.value.trim();
    if(!text) return;
    await supabase.from('messages').insert([{ chat_id:currentChat, sender:currentUser.id, content:text }]);
    input.value='';
  }
</script>
</body>
</html>
