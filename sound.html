<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü–µ—Ä–µ–¥–∞—á–∞ –∑–≤—É–∫–æ–≤ –º–µ–∂–¥—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏</title>
  <style>
    body { font-family: sans-serif; padding: 1em; background: #f7f7f7; }
    textarea { width: 100%; height: 80px; }
    button { margin: 0.5em 0; padding: 0.6em 1.2em; border: none; border-radius: 8px; background: #4a90e2; color: white; font-size: 16px; cursor: pointer; transition: transform 0.2s ease, background 0.2s; }
    button:hover { transform: scale(1.05); background: #357ABD; }
    .library { margin-top: 1em; }
    .sound-item { background: white; border-radius: 10px; padding: 0.8em; margin: 0.5em 0; box-shadow: 0 2px 6px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s ease, background 0.2s; }
    .sound-item:hover { transform: translateY(-2px); background: #eef5ff; }
    #remoteAudio { width: 100%; margin-top: 1em; }
    #qrcode { margin: 1em 0; }
  </style>
</head>
<body>
  <h2>–ü–µ—Ä–µ–¥–∞—á–∞ –∑–≤—É–∫–æ–≤ –º–µ–∂–¥—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏ (WebRTC + QR)</h2>

  <button id="startBtn">üé§ –°–æ–∑–¥–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</button>
  <textarea id="offer" placeholder="–ö–æ–¥ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏"></textarea>
  <div id="qrcode"></div>

  <button id="answerBtn">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
  <textarea id="remote" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –∫–æ–¥"></textarea>

  <button id="setAnswerBtn">‚úÖ –í—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
  <textarea id="answer" placeholder="–û—Ç–≤–µ—Ç –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –æ–±—Ä–∞—Ç–Ω–æ"></textarea>

  <h3>üéµ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–≤—É–∫–æ–≤</h3>
  <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –∑–≤—É–∫–∞..." />
  <div class="library" id="library"></div>

  <audio id="remoteAudio" autoplay controls></audio>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>

  <script>
    const sounds = [
      { name: "–ê–ø–ª–æ–¥–∏—Å–º–µ–Ω—Ç—ã", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
      { name: "–°–º–µ—Ö", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
      { name: "–ó–≤–æ–Ω–æ–∫", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" },
    ];

    let pc, dataChannel, audio = new Audio();

    function renderLibrary(filter="") {
      const lib = document.getElementById("library");
      lib.innerHTML = "";
      sounds.filter(s => s.name.toLowerCase().includes(filter.toLowerCase()))
        .forEach(sound => {
          const div = document.createElement("div");
          div.className = "sound-item";
          div.textContent = sound.name;
          div.onclick = () => {
            audio.src = sound.url;
            audio.play();
            if (dataChannel && dataChannel.readyState === "open") {
              dataChannel.send(sound.url);
            }
          };
          lib.appendChild(div);
        });
    }

    document.getElementById("search").oninput = e => renderLibrary(e.target.value);
    renderLibrary();

    async function initPeer() {
      pc = new RTCPeerConnection();
      dataChannel = pc.createDataChannel("sound");
      dataChannel.onmessage = (event) => {
        document.getElementById("remoteAudio").src = event.data;
      };
      pc.ondatachannel = (event) => {
        event.channel.onmessage = (ev) => {
          document.getElementById("remoteAudio").src = ev.data;
        };
      };
    }

    document.getElementById("startBtn").onclick = async () => {
      await initPeer();
      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      const sdp = JSON.stringify(offer);
      document.getElementById("offer").value = sdp;
      document.getElementById("qrcode").innerHTML = "";
      new QRCode(document.getElementById("qrcode"), sdp);
    };

    document.getElementById("answerBtn").onclick = async () => {
      await initPeer();
      const offer = JSON.parse(document.getElementById("remote").value);
      await pc.setRemoteDescription(offer);
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
      document.getElementById("answer").value = JSON.stringify(answer);
    };

    document.getElementById("setAnswerBtn").onclick = async () => {
      const answer = JSON.parse(document.getElementById("remote").value);
      await pc.setRemoteDescription(answer);
      alert("–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!");
    };
  </script>
</body>
</html>
